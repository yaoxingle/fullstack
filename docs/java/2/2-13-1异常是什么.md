## 什么是异常？

术语*异常*是短语“异常事件”的简写。

> 定义:异常是一个事件，发生在一个程序的执行过程中，它中断了程序指令的正常流程。  

当方法内部发生错误时，该方法创建一个对象并将其移交给运行时系统。 该对象称为异常对象，包含有关错误的信息，包括错误的类型和错误发生时程序的状态。 创建异常对象并将其传递给运行时系统称为抛出异常。  

在方法抛出异常后，运行时系统试图找到一些东西来处理它。 处理异常的可能的“东西”集合是为了到达发生错误的方法而被调用的方法的有序列表。 方法列表被称为调用堆栈(见下图)。  

![调用栈](2-13-1异常是什么.assets/call-stack.png)

​																									调用堆栈

运行时系统在调用堆栈中搜索包含可以处理异常的代码块的方法。 这个代码块称为异常处理程序。 搜索从发生错误的方法开始，然后按照调用方法的相反顺序遍历调用堆栈。 当找到适当的处理程序时，运行时系统将异常传递给该处理程序。 如果抛出的异常对象的类型与该处理程序可以处理的类型相匹配，则认为该异常处理程序是适当的。  

所选择的异常处理程序被称为捕获异常。 如果运行时系统竭尽全力搜索调用堆栈上的所有方法，却没有找到适当的异常处理程序，如下图所示，运行时系统(以及程序)将终止。  

![在调用堆栈中搜索异常处理程序](2-13-1异常是什么.assets/exception-handler.png)

​																						 在调用堆栈中搜索异常处理程序  

使用异常来管理错误比传统的错误管理技术有一些优势。您可以在例外的优势部分了解更多信息。

 

## The Catch or Specify 要求

有效的 Java 编程语言代码必须遵守*Catch 或 Specify 要求*。这意味着可能会抛出某些异常的代码必须由以下任一项括起来：

- 一个`try`是捕捉异常的语句。在`try`必须为异常提供了一个处理程序，在捕捉和处理异常描述。
- 指定它可以抛出异常的方法。该方法必须提供一个`throws`列出异常的子句，如指定方法引发的异常中所述。

未能遵守 Catch 或 Specify 要求的代码将无法编译。

并非所有的异常都受Catch或Specify要求的约束。 为了理解其中的原因，我们需要看看三个基本的例外类别，其中只有一个是符合要求的。  

 

## 三种异常

第一类异常是受检异常。 这些都是编写良好的应用程序应该预料到并从中恢复的特殊情况。 例如，假设应用程序提示用户输入文件名，然后通过将文件名传递给java.io.FileReader的构造函数来打开文件。 通常，用户提供现有可读文件的名称，因此FileReader对象的构造会成功，应用程序的执行也会正常进行。 但有时用户提供一个不存在的文件的名称，构造函数就会抛出java.io.FileNotFoundException异常。 编写良好的程序将捕获此异常并通知用户错误，可能会提示用户输入正确的文件名。  

受检异常受捕获或指定需求的约束。 所有异常都是经过检查的异常，除了由Error、RuntimeException及其子类指示的异常。  

第二种异常是错误。 这些是应用程序外部的异常情况，应用程序通常无法预料或无法恢复。 例如，假设一个应用程序成功地打开了一个供输入的文件，但是由于硬件或系统故障而无法读取该文件。 不成功的读取将抛出java.io.IOError。 应用程序可能会选择捕获这个异常，以便通知用户这个问题——但是对于程序来说，打印一个堆栈跟踪并退出也可能是有意义的。  

错误不受捕获或指定需求的约束。 错误是由Error及其子类指示的异常。  

第三种异常是运行时异常。 这些是应用程序内部的异常情况，应用程序通常无法预见或恢复。 这些通常表示编程错误，如逻辑错误或API的不当使用。 例如，考虑前面描述的将文件名传递给FileReader构造函数的应用程序。 如果逻辑错误导致null被传递给构造函数，构造函数将抛出NullPointerException。 应用程序可以捕获此异常，但消除导致异常发生的bug可能更有意义。  

运行时异常不受捕获或指定需求的约束。 运行时异常是由RuntimeException及其子类指示的异常。  

错误和运行时异常统称为未检查异常。  