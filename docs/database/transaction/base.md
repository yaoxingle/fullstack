#### 一、什么是事务？事务的特性(ACID)

什么是事务：事务是程序中一系列严密的操作，所有操作执行必须成功完成，否则在每个操作所做的更改将会被撤销，这也是事务的原子性（要么成功，要么失败）。

事务特性分为四个：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持续性（Durability）简称ACID

##### 1、原子性：

事务是数据库的逻辑工作单位，事务中包含的各操作要么都做，要么都不做。

##### 2、一致性：

事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态。因此当数据库只包含成功事务提交的结果时，就说数据库处于一致性状态。如果数据库系统运行中发生故障，有些事务尚未完成就被迫中断，这些未完成事务对数据库所做的修改有一部分已写入物理数据库，这时数据库就处于一种不正确的状态，或者说是不一致的状态。

##### 3、隔离性：

一个事务的执行不能其它事务干扰。即一个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务之间不能互相干扰。

##### 4、持久性：

也称永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。接下来的其它操作或故障不应该对其执行结果有任何影响。

#### 二、事务的隔离级别

并发过程中会出现的问题：

> 丢失更新：是不可重复读的特殊情况。如果两个事物都读取同一行，然后两个都进行写操作，并提交，第一个事物所做的改变就会丢失。
>
> 脏读：一个事务读取到另一个事务未提交的更新数据。
>
> 幻读也叫虚读：一个事务执行两次查询，第二次结果集包含第一次中没有或某些行已经被删除的数据，造成两次结果不一致，只是另一个事务在这两次查询中间插入或删除了数据造成的。
>
> 不可重复读：一个事务两次读取同一行的数据，结果得到不同状态的结果，中间正好另一个事务更新了该数据，两次结果相异，不可被信任。

##### 1、未提交读（Read uncommitted）

定义：就是一个事务读取到其他事务未提交的数据，是级别最低的隔离机制。

缺点：会产生脏读、不可重复读、幻读。

##### 2、提交读（Read committed)

定义：就是一个事务读取到其他事务提交后的数据。Oracle默认隔离级别。

缺点：会产生不可重复读、幻读。

##### 3、可重复读（Repeatable read）

定义：就是一个事务对同一份数据读取到的相同，不在乎其他事务对数据的修改。MySQL默认的隔离级别。

缺点：会产生幻读。

##### 4、串行化（Serializable）

定义：事务串行化执行，隔离级别最高，牺牲了系统的并发性。

缺点：可以解决并发事务的所有问题。但是效率地下，消耗数据库性能，一般不使用。

#### 三、事务传播模式

Propagation枚举了多种事务传播模式，部分列举如下：

##### 1、REQUIRED(默认模式)：

业务方法需要在一个容器里运行。如果方法运行时，已经处在一个事务中，那么加入到这个事务，否则自己新建一个新的事务。

##### 2、NOT_SUPPORTED：

声明方法不需要事务。如果方法没有关联到一个事务，容器不会为他开启事务，如果方法在一个事务中被调用，该事务会被挂起，调用结束后，原先的事务会恢复执行。

##### 3、REQUIRESNEW：

不管是否存在事务，该方法总汇为自己发起一个新的事务。如果方法已经运行在一个事务中，则原有事务挂起，新的事务被创建。

##### 4、 MANDATORY：

该方法只能在一个已经存在的事务中执行，业务方法不能发起自己的事务。如果在没有事务的环境下被调用，容器抛出例外。

##### 5、SUPPORTS：

该方法在某个事务范围内被调用，则方法成为该事务的一部分。如果方法在该事务范围外被调用，该方法就在没有事务的环境下执行。

##### 6、NEVER：

该方法绝对不能在事务范围内执行。如果在就抛例外。只有该方法没有关联到任何事务，才正常执行。

##### 7、NESTED：

如果一个活动的事务存在，则运行在一个嵌套的事务中。如果没有活动事务，则按REQUIRED属性执行。它使用了一个单独的事务，这个事务拥有多个可以回滚的保存点。内部事务的回滚不会对外部事务造成影响。它只对DataSourceTransactionManager事务管理器起效。

#### 4、事务几种实现方式

##### （1）编程式事务管理对基于 POJO 的应用来说是唯一选择。我们需要在代码中调用beginTransaction()、commit()、rollback()等事务管理相关的方法，这就是编程式事务管理。

##### （2）基于 TransactionProxyFactoryBean的声明式事务管理

##### （3）基于 @Transactional 的声明式事务管理

##### （4）基于Aspectj AOP配置事务